<html>
<head>
<title>main.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
main.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">PyPDF2</span>
<span class="s0">import </span><span class="s1">re</span>

<span class="s0">def </span><span class="s1">extract_text_from_pdf(pdf_file: str) -&gt; [str]:</span>
    <span class="s0">with </span><span class="s1">open(pdf_file</span><span class="s0">, </span><span class="s2">'rb'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">pdf:</span>
        <span class="s1">reader = PyPDF2.PdfReader(pdf</span><span class="s0">,</span><span class="s1">strict=</span><span class="s0">False</span><span class="s1">)</span>
        <span class="s1">pdf_text = []</span>

        <span class="s0">for </span><span class="s1">page </span><span class="s0">in </span><span class="s1">reader.pages:</span>
            <span class="s1">content = page.extract_text()</span>
            <span class="s1">pdf_text.append(content)</span>

        <span class="s0">return </span><span class="s1">pdf_text </span><span class="s3">#entire list of pdf</span>

<span class="s0">def </span><span class="s1">list_creation(startword</span><span class="s0">,</span><span class="s1">endword</span><span class="s0">,</span><span class="s1">fulltext):</span>
    <span class="s3"># Use regular expressions to find the indices of the words</span>
    <span class="s1">matches = re.finditer(startword</span><span class="s0">, </span><span class="s1">fulltext)</span>

    <span class="s3"># Extract the text between the two indices for each occurrence</span>
    <span class="s1">results = []</span>

    <span class="s0">for </span><span class="s1">match </span><span class="s0">in </span><span class="s1">matches:</span>
        <span class="s1">start = match.end()</span>
        <span class="s1">end_match = re.search(endword</span><span class="s0">, </span><span class="s1">fulltext[start:])</span>
        <span class="s0">if </span><span class="s1">end_match </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">end = start + end_match.start()</span>
            <span class="s1">result = fulltext[start:end].strip()</span>
            <span class="s1">results.append(result)</span>

    <span class="s0">return </span><span class="s1">results</span>

<span class="s0">if </span><span class="s1">__name__ == </span><span class="s2">'__main__'</span><span class="s1">:</span>

    <span class="s1">extracted_text = extract_text_from_pdf(</span><span class="s2">'NALPDirectory2018.pdf'</span><span class="s1">)</span>
    <span class="s0">for </span><span class="s1">text </span><span class="s0">in </span><span class="s1">extracted_text: </span><span class="s3">#each line in the pdf</span>
        <span class="s3">#print(text)</span>
        <span class="s0">import </span><span class="s1">re</span>
        <span class="s0">import </span><span class="s1">pandas </span><span class="s0">as </span><span class="s1">pd</span>

    <span class="s3">#turn list of pdf to string</span>
    <span class="s1">text = </span><span class="s2">' '</span><span class="s1">.join(extracted_text)</span>

    <span class="s3"># Organizational Narrative text</span>
    <span class="s1">word1 = </span><span class="s2">'Organization Narrative'</span>
    <span class="s1">word2 = </span><span class="s2">'NALP is committed'</span>

    <span class="s1">narratives = list_creation(word1</span><span class="s0">, </span><span class="s1">word2</span><span class="s0">, </span><span class="s1">text)</span>
    <span class="s1">narrative = []</span>
    <span class="s0">for </span><span class="s1">x </span><span class="s0">in </span><span class="s1">narratives:</span>
        <span class="s1">narrative.append(x)</span>


    <span class="s3">#General Practice Areas text</span>
    <span class="s1">word3 = </span><span class="s2">'General Practice Areas' </span><span class="s3">#after</span>
    <span class="s1">word4 = </span><span class="s2">'HIRING &amp; RECRUITMENT' </span><span class="s3">#2019 and 2018</span>
    <span class="s3">#word4 = &quot;Diversity &amp; Inclusion&quot; #2021 and 2020</span>

    <span class="s1">generalPractices = list_creation(word3</span><span class="s0">, </span><span class="s1">word4</span><span class="s0">, </span><span class="s1">text)</span>
    <span class="s1">generalPractice = []</span>
    <span class="s0">for </span><span class="s1">y </span><span class="s0">in </span><span class="s1">generalPractices:</span>
        <span class="s3">#print(y)</span>
        <span class="s1">generalPractice.append(y)</span>

    <span class="s3">#firm</span>
    <span class="s1">word11 = </span><span class="s2">'Veteran' </span><span class="s3">#after</span>
    <span class="s1">word12 = </span><span class="s2">'Basic Information' </span><span class="s3">#before</span>

    <span class="s1">firms = list_creation(word11</span><span class="s0">, </span><span class="s1">word12</span><span class="s0">, </span><span class="s1">text)</span>
    <span class="s1">firm = []</span>

    <span class="s3"># Firm RegEx, firm websites in parentheses</span>
    <span class="s0">for </span><span class="s1">z </span><span class="s0">in </span><span class="s1">firms:</span>
        <span class="s0">try</span><span class="s1">:</span>
            <span class="s1">match = re.findall(</span><span class="s2">'\((www[A-Za-z\.-]+)\)'</span><span class="s0">, </span><span class="s1">z)</span>
            <span class="s3"># if match empty try</span>
            <span class="s0">if not </span><span class="s1">match:</span>
                <span class="s1">match = re.findall(</span><span class="s2">'\(([A-Za-z\.-]+)\)'</span><span class="s0">, </span><span class="s1">z)</span>
                <span class="s3"># if empty still try</span>
                <span class="s0">if not </span><span class="s1">match:</span>
                    <span class="s1">match = re.findall(</span><span class="s2">'\(([A-Za-z\.-]+)\)'</span><span class="s0">, </span><span class="s1">z)</span>
                    <span class="s3"># if empty still try</span>
                    <span class="s0">if not </span><span class="s1">match:</span>
                        <span class="s1">match = re.findall(</span><span class="s2">'\((http://www[A-Za-z\.-]+)/{0,1}\)'</span><span class="s0">, </span><span class="s1">z)</span>
                        <span class="s3"># if empty still try</span>
                        <span class="s0">if not </span><span class="s1">match:</span>
                            <span class="s1">match = re.findall(</span><span class="s2">'\((http://[A-Za-z\.-]+)/{0,1}\)'</span><span class="s0">, </span><span class="s1">z)</span>
                            <span class="s0">if not </span><span class="s1">match:</span>
                                <span class="s1">match = [</span><span class="s2">&quot;NaN&quot;</span><span class="s1">]</span>
            <span class="s1">firm.append(match)</span>
        <span class="s0">except </span><span class="s1">IndexError:</span>
            <span class="s1">firm.append([</span><span class="s2">&quot;IndexError&quot;</span><span class="s1">])</span>

    <span class="s3"># Basic Information</span>
    <span class="s1">word8 = </span><span class="s2">'Basic Information'</span>
    <span class="s3">#word9 = '.org'</span>
    <span class="s3">#word10 = '.com'</span>
    <span class="s1">word9 = </span><span class="s2">&quot;Compensation &amp; Benefits&quot; </span><span class="s3">#2021, 2020, 2019, 2018</span>

    <span class="s3"># Use regular expressions to find the indices of the words</span>
    <span class="s1">matches = re.finditer(word8</span><span class="s0">, </span><span class="s1">text)</span>

    <span class="s3"># Extract the text between the two indices for each occurrence</span>
    <span class="s1">results = []</span>
    <span class="s0">for </span><span class="s1">match </span><span class="s0">in </span><span class="s1">matches:</span>
        <span class="s1">start = match.end()</span>
        <span class="s1">end_match = re.search(word9</span><span class="s0">, </span><span class="s1">text[start:]) </span><span class="s3">#or word10</span>
        <span class="s0">if </span><span class="s1">end_match </span><span class="s0">is not None</span><span class="s1">:</span>
            <span class="s1">end = start + end_match.start()</span>
            <span class="s1">result = text[start:end].strip()</span>
            <span class="s1">results.append(result)</span>

    <span class="s3"># Use RegEx to get just the city</span>
    <span class="s1">city = []</span>
    <span class="s0">for </span><span class="s1">result </span><span class="s0">in </span><span class="s1">results:</span>
        <span class="s1">match = re.search(</span><span class="s2">'[A-Za-z]+, [A-Za-z]{2}\s[0-9]{5}-{0,1}[0-9]{0,4}'</span><span class="s0">, </span><span class="s1">result) </span><span class="s3">#added {2}, got rid of +</span>
        <span class="s0">if </span><span class="s1">match:</span>
            <span class="s1">city.append(match.group())</span>
        <span class="s0">else</span><span class="s1">:</span>
            <span class="s1">match = </span><span class="s2">&quot;NaN&quot;</span>
            <span class="s1">city.append(match)</span>

    <span class="s3">#create dataframe, use zip files for multiples lists. Get lists of all of this.</span>
    <span class="s1">df = pd.DataFrame(list(zip(firm</span><span class="s0">, </span><span class="s1">city</span><span class="s0">, </span><span class="s1">generalPractice</span><span class="s0">, </span><span class="s1">narrative))</span><span class="s0">, </span><span class="s1">columns=[</span><span class="s2">'Firm'</span><span class="s0">, </span><span class="s2">'City'</span><span class="s0">,</span><span class="s2">'General_Practice'</span><span class="s0">,</span><span class="s2">'Organizational_Narrative'</span><span class="s1">])</span>
    <span class="s1">df[</span><span class="s2">&quot;Firm&quot;</span><span class="s1">] = df.Firm.apply(</span><span class="s0">lambda </span><span class="s1">x: x[</span><span class="s4">0</span><span class="s1">])</span>
    <span class="s1">df.to_csv(</span><span class="s2">&quot;NALP_2018_testing328.csv&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>